# Todoアプリ

## モチベーション

- この書籍はアプリの作り方を学ぶものではない
- インターフェイスに注目する
- コードの読み方を考える
- 具体的な説明をするが、アプリの作り方の詳細というよりはどのような原理でコンポーネントを考えるかというところに焦点を置く
- 新しいAPIが大量にでてくるため丁寧に

## 目的

- オブジェクト指向なアプリケーション開発
- クラスの使い方
- 状態をもつアプリ
- モジュールの使い方
    - 理解し易い構造を作ること
    - スケールするためにモジュール化する
- イベント駆動/ライフサイクル
    - DOMイベントと自作イベント
- 入力に対する反応としての反応
    - イベント
    - 描画の更新

## やらないこと

- タイトルの更新
- フィルター

## 守るべきルール

- セクション間で出したコードはそれぞれ独立して動作すること

## 作るもの

- シンプルなTodoアプリ

### できること

- Todoアイテムの追加
- Todoアイテムの削除
- Todoアイテムの更新（✓）

## イベント

### DOM

- load
- unload
- submit
- click
- change

### アプリ

- Change
    - Add
    - Remove
    - Update

## 状態

- TODOリスト
- Todoアイテム
    - completed
  
## アウトライン

- 目的: モジュールなアプリを開発する
- 目的: イベント駆動を理解する
    - ブラウザ、アプリ
- なぜTodoアプリ
    - 実際にウェブアプリを開発する際にはさまざまな機能が実装されたライブラリやある種のアプリ開発の仕組みをサポートするフレームワークを使うことが現実的です
    - 特にウェブアプリ開発の際にそのスタイルを決めるのは表示を管理するViewのライブラリです
    - ここで実装するTodoアプリと呼ばれるシンプルなタスク管理アプリは、どのViewライブラリでもサンプルとして提供されています
    - TodoMVCというTodoアプリのリファレンス実装があり、各ライブラリはこのTodoMVCを実装したものをサンプルとして提供しています
    - これはユーザーからすれば各ライブラリの書き味を確かめることができ、ライブラリ作者からすればユーザーに慣れ親しんだアプリをどうかけるのを示すサンプルとなります
    - ここで実装するTodoアプリはTodoMVCをもっと簡素化したものですが、このアプリの作り方を理解すれば実際にライブラリを使ったアプリの開発に役立つでしょう
- エントリポイント
    - JavaScriptのエントリポイントについて
- Todoアプリの構成
    - Todoアプリを実行するブラウザにはいわゆるiOSやAndroidのようにOSが提供するようなフレームワークがデフォルトにはありません
    - そのためさまざまなユーザーが実装したライブラリやフレームワークがあり、それを使ってアプリを作るのが一般的です
    - これは１つのTodoアプリをとっても書き方がかなりの種類があることをしめしています
    - まずは全体像を示してみます
        - HTML
        - JS
        - CSS
    - HTMLは静的です。動的な部分をJavaScriptで管理し構築します
    - CSSは見た目を変更する
- TodoAppを作っていく
- ウェブアプリはイベント駆動
- onloadでTodoアプリをrenderingする
- formのイベントを取る
- デフォルトのイベントを止める
- ContainerにHTMLを追加
- DOMとアプリを切り離す
- モデル　–　この意味は場所によってバラバラですが、ここではアプリの状態を表しDOM APIに依存していないコードのことを言いましょう
    - DOM APIに依存していないということはブラウザだけではなく、Node.jsでもそのまま取り込み実行できることを意味しています
    - この構造を取る率直なメリットはテストがしやすいことです
- モデルと表示
    - さきほども書いたウェブアプリはイベント駆動であることが多いです。
    - モデルに置いてもイベント駆動で、モデルの状態と表示の更新を考えてみましょう
    - ものすごく簡単にいえば、モデルの状態が更新されたら表示は更新されるように作れば、モデルの実装に集中できます。
    - 一般に表示の確認は実際にブラウザを起動して、URLにアクセスして、特定の操作をして、その時の表示を確認すると言った過程があり確認コストが高いです。
    - 一方モデルはただのJavaScriptなので、単純なユニットテストで状態を確認できます。
    - もちろん表示を確認するテスト手法もありますが、多くの場合はユニットテストよりも手間がかかることには変わらないでしょう。
- Todoイベントを整理する
    - このTodoアプリには次のタスクがあります
        - Todoを追加する
        - Todoを更新する(完了済みかを更新する)
        - Todoを削除する
    - これらをイベントとして考えてみましょう。
        - フォームでEnterを押したら -> Todoを追加する
        - Todoのチェックボックを押したら -> Todoを更新する
        - Todoの削除ボタンを押したら -> Todoを削除する
    - 何か操作（イベントが発生）をしたらTodoアプリが変化し表示が更新されるという流れになっていることが分かります
    - この更新内容をどのように表示へ反映するかというアーキテクチャは様々なものがあり手法が色々です。
    - 更新する時の場所をまとめることで、一度の操作で複数の箇所を更新することが楽になります。
        - フォームでEnterを押したら -> Todoモデルが更新される -> 表示が更新される
        - Todoのチェックボックを押したら -> Todoモデルが更新される -> 表示が更新される
        - Todoの削除ボタンを押したら -> Todoモデルが更新される -> 表示が更新される
    - このようにモデルを元に表示を更新するというようなレイヤーを分けて考えていくのをレイヤードアーキテクチャといいますが
    - このような手法はアプリが複雑化するにつれて必要になっていく考え方です。
    - 一方今回のようなアプリには別になくても実装できますが拡張性を考えていきます。
- Todoを追加する
- Todoを更新する
- Todoを削除する

## コンポーネント

説明するものをコンポーネントとして見ていく。

- 静的HTML
- CSS
- ディレクトリ構造
- ローカルサーバ    
    - モジュールがCORSにかかるため
- index.js
    - App
    - エントリポイント
- DOMイベント
    - 目的: イベントで表示を更新することを学ぶ
        - ゲームなどを除きDOM要素を使ったウェブアプリは殆どがイベント駆動
        - 時間経過で変化するのではなくイベントによって変化する部分が大体を占める
        - イベントとは何かが**起きた**ことを通知するもの
        - またDOM要素のイベントには発生時にデフォルトの動作が規定されているものがあります。
        - 例えば"click"イベントはクリックと同時に発生し、デフォルトの動作はその要素をclickすることです。
        - DOM Eventはこれらのデフォルトの動作を停止することができます
    - submitを止めてみましょう
    - 止まらなかった場合はリロードされています
    - イベントが発生したらViewを更新してみましょう
        - html-utilを作る?
- EventEmitter
    - 自分でイベントを作ってみましょう
    - なぜEventTargetではない
        - EventTargetはDOMにしかないから
- Model
    - TodoItem
    - TodoList
- View
    - html-util
    - TodoListView

### 動作フロー

- window onload
- App mount
    - Initialize
- Event
    - submit -> update view
    - delete -> update view
    - change -> update view
- View
    - call -> update model
- Model
    - called -> update state -> emit event
- Controller
    - receive event -> call update view

## 新しく登場するAPI

- EventEmitter
- querySelector
- innerHTML
- addEventListner
- event
    - `preventDefault`
- Element
- HTML
    - `<template>`

## 注意事項

他のユースケースと表記は揃える

- HTTPサーバ
- DOM取得（query selector?）
- addEventListnerの第三引数


### 構造を知る

- アプリを作るにあたって重要なのは構造
- 常にセクションで構造を把握できるディレクトリを表示する
